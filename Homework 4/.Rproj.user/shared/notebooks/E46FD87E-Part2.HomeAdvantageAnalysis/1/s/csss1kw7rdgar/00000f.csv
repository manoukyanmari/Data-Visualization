"0","# Create match result column manually using goals"
"0","bundesliga <- bundesliga %>%"
"0","  mutate(result = case_when("
"0","    fthg > ftag ~ ""H"","
"0","    ftag > fthg ~ ""A"","
"0","    TRUE ~ ""D"""
"0","  )) %>%"
"0","  filter(result %in% c(""H"", ""A""))  # exclude draws"
"0",""
"0","# Convert to long format with team and location"
"0","win_summary <- bundesliga %>%"
"0","  pivot_longer(cols = c(hometeam, awayteam), names_to = ""loc"", values_to = ""team"") %>%"
"0","  mutate(win = case_when("
"0","    result == ""H"" & loc == ""hometeam"" ~ 1,"
"0","    result == ""A"" & loc == ""awayteam"" ~ 1,"
"0","    TRUE ~ 0"
"0","  )) %>%"
"0","  group_by(season, team, loc) %>%"
"0","  summarise(wins = sum(win, na.rm = TRUE), .groups = 'drop')"
"0",""
"0","# Convert back to wide format for heatmap"
"0","win_wide <- win_summary %>%"
"0","  pivot_wider(names_from = loc, values_from = wins, values_fill = 0)"
"0",""
"0","# Prepare heatmap data"
"0","heat_data <- melt(win_wide, id.vars = c(""season"", ""team""))"
"0",""
"0","# Plot the heatmap"
"0","ggplot(heat_data, aes(x = season, y = team, fill = value)) +"
"0","  geom_tile(color = ""white"") +"
"0","  facet_wrap(~variable) +"
"0","  scale_fill_gradient(low = ""lightyellow"", high = ""darkblue"") +"
"0","  labs(title = ""Heatmap of Wins by Team (Home vs Away)"","
"0","       x = ""Season"", y = ""Team"", fill = ""Wins"") +"
"0","  theme_minimal()"
